<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Strategic Wealth Projection 2026 - GitHub Sync</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root {
            --cbus-navy: #002e6d;
            --cbus-green: #71B44D;
            --cbus-light-gray: #f4f8fb;
            --cbus-white: #ffffff;
            --comp-red: #e53e3e;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--cbus-light-gray); color: #2c3e50; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: var(--cbus-white); padding: 40px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); border-top: 12px solid var(--cbus-navy); }
        
        .header { text-align: center; margin-bottom: 30px; position: relative; }
        .logo-placeholder { font-size: 32px; font-weight: 900; color: var(--cbus-navy); letter-spacing: -1px; margin-bottom: 10px; }
        .logo-placeholder span { color: var(--cbus-green); }
        
        .setup-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 30px; background: #fff; border: 1px solid #e2e8f0; padding: 25px; border-radius: 12px; }
        .input-box label { display: block; font-size: 11px; font-weight: bold; margin-bottom: 8px; color: var(--cbus-navy); text-transform: uppercase; }
        input, select { width: 100%; padding: 10px; border: 2px solid #cbd5e0; border-radius: 8px; font-size: 14px; box-sizing: border-box; }

        .fund-comparison-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        .fund-pane { padding: 20px; border-radius: 12px; border: 3px solid #e2e8f0; background: #fff; }
        .fund-pane.a { border-color: var(--cbus-navy); }
        .fund-pane.b { border-color: var(--comp-red); }
        .fund-pane h3 { margin-top: 0; color: var(--cbus-navy); }

        button { width: 100%; padding: 20px; background: var(--cbus-navy); color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #004094; }

        .chart-section { margin-top: 40px; padding: 20px; background: white; border-radius: 12px; border: 1px solid #e2e8f0; }
        .table-section { margin-top: 30px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { background: var(--cbus-navy); color: white; padding: 12px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #edf2f7; }
        .bal-a { font-weight: bold; color: var(--cbus-navy); }
        .bal-b { font-weight: bold; color: var(--comp-red); }
        optgroup { font-weight: bold; color: var(--cbus-navy); font-style: normal; background: #f0f4f8; }
        
        #loadingOverlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(255,255,255,0.9); display: flex; align-items: center; 
            justify-content: center; z-index: 1000; font-weight: bold; color: var(--cbus-navy);
        }
    </style>
</head>
<body>

<div id="loadingOverlay">Synchronizing with GitHub Data...</div>

<div class="container">
    <div class="header">
        <div class="logo-placeholder">STRATEGIC <span>COMPARISON</span></div>
        <p>Projected Wealth Analysis based on GitHub Hosted Data (/calculators)</p>
    </div>

    <div class="setup-grid">
        <div class="input-box"><label>Current Age</label><input type="number" id="age" value="35"></div>
        <div class="input-box"><label>Retirement Age</label><input type="number" id="retAge" value="67"></div>
        <div class="input-box"><label>Current Balance ($)</label><input type="number" id="balance" value="100000"></div>
        <div class="input-box"><label>Current Salary ($)</label><input type="number" id="salary" value="100000"></div>
        <div class="input-box"><label>Employer SG (%)</label><input type="number" id="sgRate" value="12"></div>
        <div class="input-box"><label>Sal Sacrifice ($ Annual)</label><input type="number" id="salSac" value="0"></div>
        <div class="input-box"><label>Wage Inflation (%)</label><input type="number" id="wageInf" value="3.0"></div>
    </div>

    <div class="fund-comparison-grid">
        <div class="fund-pane a">
            <h3>Primary Choice</h3>
            <label>Select Account Type</label>
            <select id="fundA" onchange="updateOptions('A')">
                <option value="cbus_super">CBUS - Super (MySuper)</option>
                <option value="cbus_ttr">CBUS - Transition to Retirement</option>
                <option value="cbus_retired">CBUS - Fully Retired</option>
                <option value="aus_super">AustralianSuper</option>
                <option value="aware">Aware Super</option>
                <option value="art">ART</option>
                <option value="hostplus">Hostplus</option>
                <option value="brighter">Brighter Super</option>
                <option value="bussq">BUSSQ</option>
                <option value="plum">Plum (MLC)</option>
            </select>
            <label style="margin-top:10px; display:block;">Investment Option (By Longest Available)</label>
            <select id="optA"></select>
        </div>

        <div class="fund-pane b">
            <h3>Comparison Fund</h3>
            <label>Select Account Type</label>
            <select id="fundB" onchange="updateOptions('B')">
                <option value="hostplus">Hostplus</option>
                <option value="cbus_super">CBUS - Super (MySuper)</option>
                <option value="cbus_ttr">CBUS - Transition to Retirement</option>
                <option value="cbus_retired">CBUS - Fully Retired</option>
                <option value="aus_super">AustralianSuper</option>
                <option value="aware">Aware Super</option>
                <option value="art">ART</option>
                <option value="brighter">Brighter Super</option>
                <option value="bussq">BUSSQ</option>
                <option value="plum">Plum (MLC)</option>
            </select>
            <label style="margin-top:10px; display:block;">Investment Option (By Longest Available)</label>
            <select id="optB"></select>
        </div>
    </div>

    <button onclick="calculate()">GENERATE COMPARISON PROJECTION</button>

    <div class="chart-section" id="chartArea" style="display:none;">
        <canvas id="compChart"></canvas>
    </div>

    <div class="table-section" id="tableArea" style="display:none;">
        <table id="resultsTable">
            <thead>
                <tr>
                    <th>Age</th>
                    <th>Salary</th>
                    <th>Primary Balance</th>
                    <th>Comparison Balance</th>
                    <th>Difference</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<script>
/**
 * GITHUB CONFIGURATION
 * Replace these placeholder values with your specific repository details
 */
const GITHUB_CONFIG = {
    user: "your-username", 
    repo: "your-repo-name",
    branch: "main",
    folder: "calculators"
};

// Map internal IDs to exact CSV filenames for the three CBUS types and other funds
const FUND_FILE_MAP = {
    cbus_super: "CBUS Investment Returns 31 Jan 26.xlsx - Sheet1.csv",
    cbus_ttr: "CBUS TTR Investment Returns 31 Jan 26.xlsx - Sheet1.csv",
    cbus_retired: "CBUS Fully Retired Investment Returns 31 Jan 26.xlsx - Sheet1.csv",
    hostplus: "Hostplus 31 Jan 26.xlsx - Sheet1.csv",
    aware: "Aware 31 Jan 26.xlsx - Sheet1.csv",
    art: "ART 31 Jan 26.xlsx - Sheet1.csv",
    plum: "Plum Investment Returns 31 Jan 26.xlsx - Sheet1.csv",
    bussq: "BUSSQ Investment Returns 31 Dec 25.xlsx - Sheet1.csv",
    aus_super: "Aus Super Returns 30 June 25.xlsx - Sheet1.csv",
    brighter: "Brighter Investment returns 31 Jan 26.xlsx - Sheet1.csv"
};

let remoteData = {};
let chart = null;

async function init() {
    const baseUrl = `https://raw.githubusercontent.com/${GITHUB_CONFIG.user}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/${GITHUB_CONFIG.folder}/`;
    
    const fetchPromises = Object.entries(FUND_FILE_MAP).map(async ([key, fileName]) => {
        try {
            const response = await fetch(baseUrl + encodeURIComponent(fileName));
            if (!response.ok) throw new Error(`Not found: ${fileName}`);
            const csvText = await response.text();
            remoteData[key] = processCSV(csvText);
        } catch (err) {
            console.warn(`Could not load ${fileName}:`, err);
        }
    });

    await Promise.all(fetchPromises);
    document.getElementById('loadingOverlay').style.display = 'none';
    updateOptions('A');
    updateOptions('B');
}

/**
 * Parses CSV and sorts options into groups based on the longest available date range
 */
function processCSV(csvText) {
    const parsed = Papa.parse(csvText, { header: true, skipEmptyLines: true });
    const data = parsed.data;
    const headers = parsed.meta.fields;

    const grouped = {
        "10 Years Data": [],
        "7 Years Data": [],
        "5 Years Data": [],
        "3 Years Data": [],
        "1 Year Data": []
    };

    const timeframeMap = [
        { label: "10 Years Data", keys: ["10 years", "10 yrs", "10 yr"] },
        { label: "7 Years Data",  keys: ["7 years", "7 yrs", "7 yr"] },
        { label: "5 Years Data",  keys: ["5 years", "5 yrs", "5 yr"] },
        { label: "3 Years Data",  keys: ["3 years", "3 yrs", "3 yr"] },
        { label: "1 Year Data",   keys: ["1 year", "1 yr"] }
    ];

    data.forEach(row => {
        // Investment name is typically the first key in the row
        const firstHeader = headers[0];
        const name = row[firstHeader];
        if (!name || name.trim() === "" || name.includes("Ready-made") || name.includes("Single asset")) return;

        for (const timeframe of timeframeMap) {
            const matchingHeader = headers.find(h => 
                timeframe.keys.some(k => h.toLowerCase().includes(k))
            );

            if (matchingHeader) {
                let val = row[matchingHeader];
                if (val && val !== "-" && !val.toString().toLowerCase().includes("n/a")) {
                    const rate = parseFloat(val.toString().replace('%', '')) / (val.toString().includes('%') ? 100 : 1);
                    if (!isNaN(rate)) {
                        grouped[timeframe.label].push({ name: name.trim(), rate: rate });
                        break; // Assign to the longest timeframe found and move to next row
                    }
                }
            }
        }
    });

    return grouped;
}

function updateOptions(pane) {
    const fund = document.getElementById('fund' + pane).value;
    const select = document.getElementById('opt' + pane);
    select.innerHTML = '';
    
    const fundData = remoteData[fund];
    if (!fundData) {
        const opt = document.createElement('option');
        opt.textContent = "Data Syncing...";
        select.appendChild(opt);
        return;
    }

    const order = ["10 Years Data", "7 Years Data", "5 Years Data", "3 Years Data", "1 Year Data"];
    order.forEach(groupName => {
        if (fundData[groupName] && fundData[groupName].length > 0) {
            const group = document.createElement('optgroup');
            group.label = groupName;
            fundData[groupName].forEach(o => {
                const el = document.createElement('option');
                el.value = o.rate;
                el.textContent = `${o.name} (${(o.rate * 100).toFixed(2)}% p.a.)`;
                group.appendChild(el);
            });
            select.appendChild(group);
        }
    });
}

function calculate() {
    const age = parseInt(document.getElementById('age').value);
    const retAge = parseInt(document.getElementById('retAge').value);
    const sg = parseFloat(document.getElementById('sgRate').value) / 100;
    const sSac = parseFloat(document.getElementById('salSac').value);
    const wInf = parseFloat(document.getElementById('wageInf').value) / 100;
    const rateA = parseFloat(document.getElementById('optA').value);
    const rateB = parseFloat(document.getElementById('optB').value);
    
    let balA = parseFloat(document.getElementById('balance').value);
    let balB = balA;
    let sal = parseFloat(document.getElementById('salary').value);

    let labels = [], pathA = [], pathB = [], rows = "";

    for (let year = age; year <= retAge; year++) {
        labels.push(year);
        pathA.push(balA);
        pathB.push(balB);

        rows += `<tr><td>${year}</td><td>$${Math.round(sal).toLocaleString()}</td><td class="bal-a">$${Math.round(balA).toLocaleString()}</td><td class="bal-b">$${Math.round(balB).toLocaleString()}</td><td>$${Math.round(Math.abs(balA - balB)).toLocaleString()}</td></tr>`;

        let annualContrib = ((sal * sg) + sSac) * 0.85; 
        balA = (balA + (annualContrib / 2)) * (1 + rateA) + (annualContrib / 2);
        balB = (balB + (annualContrib / 2)) * (1 + rateB) + (annualContrib / 2);
        sal *= (1 + wInf);
    }

    document.getElementById('tableBody').innerHTML = rows;
    document.getElementById('chartArea').style.display = 'block';
    document.getElementById('tableArea').style.display = 'block';
    renderChart(labels, pathA, pathB);
}

function renderChart(labels, dataA, dataB) {
    const ctx = document.getElementById('compChart').getContext('2d');
    if (chart) chart.destroy();
    chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Primary Choice',
                data: dataA,
                borderColor: '#002e6d',
                backgroundColor: 'rgba(0, 46, 109, 0.1)',
                fill: true,
                borderWidth: 3,
                tension: 0.1
            }, {
                label: 'Comparison Fund',
                data: dataB,
                borderColor: '#e53e3e',
                backgroundColor: 'rgba(229, 62, 62, 0.1)',
                fill: true,
                borderWidth: 3,
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            plugins: { tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label}: $${Math.round(ctx.parsed.y).toLocaleString()}` } } },
            scales: { y: { ticks: { callback: v => '$' + v.toLocaleString() } } }
        }
    });
}

init();
</script>
</body>
</html>